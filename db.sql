PRAGMA foreign_keys=OFF;
BEGIN TRANSACTION;
CREATE TABLE IF NOT EXISTS "migrations" ("id" integer primary key autoincrement not null, "migration" varchar not null, "batch" integer not null);
CREATE TABLE IF NOT EXISTS "cache" ("key" varchar not null, "value" text not null, "expiration" integer not null, primary key ("key"));
CREATE TABLE IF NOT EXISTS "cache_locks" ("key" varchar not null, "owner" varchar not null, "expiration" integer not null, primary key ("key"));
CREATE TABLE IF NOT EXISTS "jobs" ("id" integer primary key autoincrement not null, "queue" varchar not null, "payload" text not null, "attempts" integer not null, "reserved_at" integer, "available_at" integer not null, "created_at" integer not null);
CREATE TABLE IF NOT EXISTS "job_batches" ("id" varchar not null, "name" varchar not null, "total_jobs" integer not null, "pending_jobs" integer not null, "failed_jobs" integer not null, "failed_job_ids" text not null, "options" text, "cancelled_at" integer, "created_at" integer not null, "finished_at" integer, primary key ("id"));
CREATE TABLE IF NOT EXISTS "failed_jobs" ("id" integer primary key autoincrement not null, "uuid" varchar not null, "connection" text not null, "queue" text not null, "payload" text not null, "exception" text not null, "failed_at" datetime not null default CURRENT_TIMESTAMP);
CREATE TABLE IF NOT EXISTS "users" ("id_user" integer primary key autoincrement not null, "nama" varchar not null, "username" varchar not null, "password" varchar not null, "role" varchar check ("role" in ('admin', 'pengurus')) not null, "status" varchar check ("status" in ('aktif', 'pending', 'nonaktif')) not null, "created_at" datetime, "updated_at" datetime);
CREATE TABLE IF NOT EXISTS "tahun_ajaran" ("id_tahun_ajaran" integer primary key autoincrement not null, "tahun_mulai" integer not null, "tahun_akhir" integer not null, "status" varchar check ("status" in ('aktif', 'tidak aktif')) not null, "created_at" datetime, "updated_at" datetime);
INSERT INTO tahun_ajaran VALUES(1,2022,1993,'aktif','2024-09-08 16:02:22','2024-09-08 16:02:22');
INSERT INTO tahun_ajaran VALUES(2,2008,2019,'tidak aktif','2024-09-08 16:02:22','2024-09-08 16:02:22');
INSERT INTO tahun_ajaran VALUES(3,2011,1990,'tidak aktif','2024-09-08 16:02:22','2024-09-08 16:02:22');
CREATE TABLE IF NOT EXISTS "kelas" ("id_kelas" integer primary key autoincrement not null, "nama_kelas" varchar not null, "id_tahun_ajaran" integer not null, "created_at" datetime, "updated_at" datetime, foreign key("id_tahun_ajaran") references "tahun_ajaran"("id_tahun_ajaran") on delete cascade on update cascade);
CREATE TABLE IF NOT EXISTS "santri" ("id_santri" integer primary key autoincrement not null, "nama" varchar not null, "tempat_lahir" varchar not null, "tanggal_lahir" date not null, "jenis_kelamin" varchar check ("jenis_kelamin" in ('L', 'P')) not null, "orang_tua" varchar not null, "alamat" varchar, "telepon" varchar, "id_kelas" integer not null, "created_at" datetime, "updated_at" datetime, foreign key("id_kelas") references "kelas"("id_kelas") on delete cascade on update cascade);
CREATE TABLE IF NOT EXISTS "guru" ("id_guru" integer primary key autoincrement not null, "nama" varchar not null, "tempat_lahir" varchar not null, "tanggal_lahir" date not null, "jenis_kelamin" varchar check ("jenis_kelamin" in ('L', 'P')) not null, "alamat" varchar, "telepon" varchar, "created_at" datetime, "updated_at" datetime);
CREATE TABLE IF NOT EXISTS "mata_pelajaran" ("id_mata_pelajaran" integer primary key autoincrement not null, "kode_mapel" varchar not null, "nama_mapel" varchar not null, "guru_id" integer not null, "kelas_id" integer not null, "created_at" datetime, "updated_at" datetime, foreign key("guru_id") references "guru"("id_guru") on delete cascade, foreign key("kelas_id") references "kelas"("id_kelas") on delete cascade);
CREATE TABLE IF NOT EXISTS "kegiatan" ("id_kegiatan" integer primary key autoincrement not null, "nama_kegiatan" varchar not null, "penanggung_jawab" varchar not null, "id_tahun_ajaran" integer not null, "periode" varchar check ("periode" in ('Mingguan', 'Bulanan', 'Tahunan')) not null, "tanggal_pelaksanaan" date not null, "created_at" datetime, "updated_at" datetime, foreign key("id_tahun_ajaran") references "tahun_ajaran"("id_tahun_ajaran") on delete cascade on update cascade);
CREATE TABLE IF NOT EXISTS "absensi" ("id_absensi" integer primary key autoincrement not null, "tanggal" date not null, "jenis_absensi" varchar check ("jenis_absensi" in ('Hadir', 'Sakit', 'Izin', 'Alfa')) not null, "keterangan" varchar not null, "santri_id" integer not null, "kelas_id" integer not null, "created_at" datetime, "updated_at" datetime, foreign key("santri_id") references "santri"("id_santri") on delete cascade, foreign key("kelas_id") references "kelas"("id_kelas") on delete cascade on update cascade);
CREATE TABLE IF NOT EXISTS "nilai" ("id_nilai" integer primary key autoincrement not null, "ulangan_1" varchar, "ulangan_2" varchar, "ulangan_3" varchar, "santri_id" integer not null, "kelas_id" integer not null, "mapel_id" integer not null, "created_at" datetime, "updated_at" datetime, foreign key("santri_id") references "santri"("id_santri") on delete cascade on update cascade, foreign key("kelas_id") references "kelas"("id_kelas") on delete cascade on update cascade, foreign key("mapel_id") references "mata_pelajaran"("id_mata_pelajaran") on delete cascade on update cascade);
CREATE TABLE IF NOT EXISTS "sessions" ("id" varchar not null, "user_id" integer, "ip_address" varchar, "user_agent" text, "payload" text not null, "last_activity" integer not null, primary key ("id"));
CREATE TABLE IF NOT EXISTS "log_activities" ("id" integer primary key autoincrement not null, "user_id" integer not null, "ip_address" varchar not null, "route" varchar not null, "action" varchar not null, "created_at" datetime, "updated_at" datetime, foreign key("user_id") references "users"("id_user") on delete cascade on update cascade);
CREATE TABLE IF NOT EXISTS "personal_access_tokens" ("id" integer primary key autoincrement not null, "tokenable_type" varchar not null, "tokenable_id" integer not null, "name" varchar not null, "token" varchar not null, "abilities" text, "last_used_at" datetime, "expires_at" datetime, "created_at" datetime, "updated_at" datetime);
DELETE FROM sqlite_sequence;
INSERT INTO sqlite_sequence VALUES('migrations',41);
INSERT INTO sqlite_sequence VALUES('tahun_ajaran',3);
CREATE INDEX "jobs_queue_index" on "jobs" ("queue");
CREATE UNIQUE INDEX "failed_jobs_uuid_unique" on "failed_jobs" ("uuid");
CREATE UNIQUE INDEX "users_username_unique" on "users" ("username");
CREATE INDEX "sessions_user_id_index" on "sessions" ("user_id");
CREATE INDEX "sessions_last_activity_index" on "sessions" ("last_activity");
CREATE INDEX "personal_access_tokens_tokenable_type_tokenable_id_index" on "personal_access_tokens" ("tokenable_type", "tokenable_id");
CREATE UNIQUE INDEX "personal_access_tokens_token_unique" on "personal_access_tokens" ("token");
COMMIT;
